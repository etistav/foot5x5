{% extends "foot5x5MainBundle::layout.html.twig" %}
{% set adminMenu = true %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<h2><span class="label dark-blue-grad">{{ block('title') }}</span></h2>
{% for flashMessage in app.session.flashbag.get('success') %}
<div class="alert alert-success">
    {{ flashMessage }}
</div>
{% endfor %}
{% for flashMessage in app.session.flashbag.get('warning') %}
<div class="alert alert-warning">
    {{ flashMessage }}
</div>
{% endfor %}
<div class="col-md-12" id="random-container">
{{ form_start(randomDrawForm) }}
    <div class="col-xs-4" id="random-select-section">
        <ol id="players-selectable">
            {% for player in players %}
            <li {% if selectedPlayersList %}
                    {% if player.name in selectedPlayersList %} class="ui-widget-content ui-selected"
                    {% else %} class="ui-widget-content"
                    {% endif %}
                {% else %} class="ui-widget-content"
                {% endif %}>{{ player.name }}</li>
            {#
            <li class="ui-widget-content">{{ player.name }}</li>
            #}
            {% endfor %}
        </ol>
        {{ form_widget(randomDrawForm.selectedPlayers)}}
        <div class="col-xs-12" id="random-btn" >
            <input type="submit" class="btn btn-primary dark-blue-grad" id="random-draw-submit" value="Tirage" />
        </div>
    </div>
    <div class=" col-xs-8" id="random-teams-section">
        <div class="col-xs-6" id="random-teamA" >
            <h2><span class="label dark-blue-grad">Équipe A</span></h2>
            <dl id="random-list">
                {% if matchPlayers %}
                    {% for matchPlayer in matchPlayers %}
                        {% if matchPlayer.team == "A" %}
                        <a data-popup-open="popup-{{ matchPlayer.player.id }}" href="#">
                            <dt>
                                {% if matchPlayer.player.user is null %}
                                    <img src="{{ 'uploads/img/profilePic_default.png' | imagine_filter('avatar_40') }}" alt="profilePic_default.png" />
                                {% else %}
                                    <img src="{{ matchPlayer.player.user.pictureWebPath | imagine_filter('avatar_40') }}" alt="{{ matchPlayer.player.user.profilePicture }}" />
                                {% endif %}
                                <span>{{ matchPlayer.player.name }}</span>
                            </dt>
                        </a>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <dt>-</dt>
                    <dt>-</dt>
                    <dt>-</dt>
                    <dt>-</dt>
                    <dt>-</dt>
                {% endif %}
            </dl>
        </div>
        <div class="col-md-6" id="random-teamB" >
            <h2><span class="label dark-blue-grad">Équipe B</span></h2>
            <dl id="random-list">
                {% if matchPlayers %}
                    {% for matchPlayer in matchPlayers %}
                        {% if matchPlayer.team == "B" %}
                        <a data-popup-open="popup-{{ matchPlayer.player.id }}" href="#">
                            <dt>
                                {% if matchPlayer.player.user is null %}
                                    <img src="{{ 'uploads/img/profilePic_default.png' | imagine_filter('avatar_40') }}" alt="profilePic_default.png" />
                                {% else %}
                                    <img src="{{ matchPlayer.player.user.pictureWebPath | imagine_filter('avatar_40') }}" alt="{{ matchPlayer.player.user.profilePicture }}" />
                                {% endif %}
                                <span>{{ matchPlayer.player.name }}</span>
                            </dt>
                        </a>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <dt>-</dt>
                    <dt>-</dt>
                    <dt>-</dt>
                    <dt>-</dt>
                    <dt>-</dt>
                {% endif %}
            </dl>
        </div>
    </div>
</div>
{{ form_end(randomDrawForm) }}
<script>
    var _selectRange = false, _deselectQueue = [];
    $(function() {
        $("#players-selectable").selectable({
            selecting: function (event, ui) {
                if (event.detail == 0) {
                    _selectRange = true;
                    return true;
                }
                if ($(ui.selecting).hasClass('ui-selected')) {
                    _deselectQueue.push(ui.selecting);
                }
            },
            unselecting: function (event, ui) {
                $(ui.unselecting).addClass('ui-selected');
            },
            stop: function () {
                if (!_selectRange) {
                    $.each(_deselectQueue, function (ix, de) {
                        $(de)
                            .removeClass('ui-selecting')
                            .removeClass('ui-selected');
                    });
                }
                _selectRange = false;
                _deselectQueue = [];
            }
        });
        $("#random-draw-submit").button().click(function(event) {
            $(function() {
                var hdnValue = $('#random_draw_selectedPlayers').val();
                if(hdnValue != '') {
                    $('#random_draw_selectedPlayers').val('');
                }
                $("#players-selectable li.ui-selected", this).each(function(hdnValue) {
                    var selectedValue=$(this).text();
                    hdnValue = $('#random_draw_selectedPlayers').val();
                    if(hdnValue != '') {
                        $('#random_draw_selectedPlayers').val(hdnValue +','+selectedValue);
                    } else {
                        $('#random_draw_selectedPlayers').val(selectedValue);
                    }
                    hdnValue = $('#random_draw_selectedPlayers').val();
                });
            });
        });
    });
</script>

{% endblock %}